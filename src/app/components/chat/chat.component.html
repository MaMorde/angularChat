<mat-card class="chat">
  <mat-card-header class="mat-card__header">
    <mat-card-title class="mat-card__header-title"
      >{{ getLoggedName() }}
      <div class="chat__online-indicator"></div>
      <span class="chat__online-text">Online</span>
    </mat-card-title>
  </mat-card-header>

  <mat-card-content
    class="mat-card__content"
    #scrollMe
    [scrollTop]="scrollMe.scrollHeight"
  >
    <div
      class="chat__wrapper"
      *ngFor="let message of messages"
      [style.justify-content]="
        message.user == getLoggedName() ? 'flex-end' : 'block'
      "
    >
      <div>
        <div class="chat__block-username">
          {{ message.user }}
        </div>
        <div
          #back
          class="chat__block-message"
          [style.background]="
            message.user == getLoggedName()
              ? 'rgb(18%, 60%, 88%, 0.9)'
              : 'rgb(150, 15, 150)'
          "
        >
          <div
            class="chat__message-text"
            *ngIf="!message.editing; else editingMessage"
          >
            {{ message.text }}
          </div>
          <ng-template #editingMessage>
            <div>
              <mat-form-field>
                <input
                  matInput
                  [formControl]="messageEditControl"
                  type="text"
                  [(ngModel)]="message.text"
                  (keyup.enter)="doneEditMessage(message)"
                  (keyup.escape)="cancelEditMessage(message)"
                  autofocus
                  maxlength="256"
                />
              </mat-form-field>
            </div>
          </ng-template>
          <div class="chat__edit-message">
            <div *ngIf="message.user === getLoggedName()">
              <button
                mat-button
                (click)="editMessage(message)"
                *ngIf="!message.editing; else doneEdit"
              >
                <span class="material-icons">
                  edit
                </span>
              </button>
              <ng-template #doneEdit>
                <button
                  mat-button
                  (click)="doneEditMessage(message)"
                  [disabled]="messageEditControl.invalid"
                >
                  <span class="material-icons">
                    done
                  </span>
                </button>
              </ng-template>
              <button mat-button (click)="deleteMessage(message)">
                <span class="material-icons">
                  delete
                </span>
              </button>
            </div>
          </div>
          <div class="chat__block-date">
            <div class="chat__block-date-wrapper">
              {{ message.date | date: "HH:mm" }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </mat-card-content>

  <mat-card-actions class="mat-card__actions">
    <form class="mat-card__actions-form">
      <mat-form-field class="mat-form-field">
        <mat-label>Сообщение</mat-label>
        <input
          matInput
          [formControl]="messageControl"
          class="chat__input-message"
          autocomplete="off"
          [(ngModel)]="message"
          maxlength="256"
          placeholder="Введите сообщение..."
        />
        <mat-hint align="start"> </mat-hint>
        <mat-hint align="end">{{ message.length }} / 256</mat-hint>
      </mat-form-field>

      <button
        [disabled]="messageControl.invalid"
        mat-button
        class="chat__send-btn"
        (click)="addMessage()"
      >
        Отправить
      </button>
    </form>
  </mat-card-actions>
</mat-card>
